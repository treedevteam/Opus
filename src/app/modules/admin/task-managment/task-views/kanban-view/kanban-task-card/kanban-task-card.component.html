<!-- Card -->
                                    
    <div class="position-relative ">
    <div cdkDrag>
        
    <div
        class="flex flex-col items-start mb-3 p-5 space-y-3 shadow rounded-lg overflow-hidden bg-card position-relative"
        style="padding-bottom: 40px!important; cursor: pointer;"
        
        >
        <!-- Cover image -->
        <div (click)="openImagePopup(apiUrl+'storage/'+card.file)" class="cover-image" *ngIf="card.file ! null">
            <img class="w-100 h-25"  [src]="apiUrl+'storage/' + card.file">
        </div>
        <!-- Title -->
        <div class="flex align-center" style="width: 100%; justify-content: space-between; align-items: center;">
            <a 
            [routerLink]="['task', card.id]">
            <div class="text-lg font-medium leading-5 mb-2">{{card.title}}</div>
            </a>
            
            <div class="relative" style="position: relative;">
                <button style="position: relative;" mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                    <mat-icon style="position: relative !important;top: 0;left: 0;
                    bottom: 0; right: 0;" class="three-dots">more_vert</mat-icon>
                </button>
            </div>
            <mat-menu #menu="matMenu">
                <button   [matMenuTriggerFor]="dateTimeMenu"  mat-menu-item>Share task</button>
                <mat-menu class="date-range-menu" #dateTimeMenu="matMenu" >
                    <div class="share_task_popover"  (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()">
                        <div class="share_task_popover_header">
                            <span class="">Share task</span>
                            <a href="#" class=""></a>
                        </div>

                        <form [formGroup]="formShare"   #shareTaskNgForm="ngForm">
                            <div class="form_body_popover">
                                <mat-form-field style="width: 100%;" >
                                    <mat-select multiple [formControlName]="'boards'" disableOptionCentering>
                                    <!-- <mat-optgroup label="{{department.name}}" *ngFor="let department of departmentsWithBoard$ | async">
                                        <mat-option value="{{board.id}}" *ngFor="let board of department.boards">{{board.name}}</mat-option>
                                    </mat-optgroup> -->
                                    </mat-select>
                                </mat-form-field> 
                            </div>
                            <button type="submit" mat-raised-button color="primary">Share</button>
                        </form>
                    </div>
                </mat-menu>
             </mat-menu>
        </div>
        
        <!-- Labels -->
        <ng-container *ngIf="card.priority">
            <div >
                <div class="flex flex-wrap -mx-1 -mb-2 mb-2">
                        <div class="mx-1 mb-2 py-0.5 px-3 rounded-full text-sm font-medium text-gray-500  dark:text-gray-300 " style="color: #000!important;" [ngStyle]="{'background-color': card.priority.color + '80'}">
                            {{card.priority.name}}
                        </div>
                </div>
            </div>
        </ng-container>
        <!-- Due date -->
        <ng-container *ngIf="card.deadline">
            <div
                class="flex items-center rounded text-sm font-medium leading-5 text-secondary mb-2"
                [ngClass]="{'text-red-600': isOverdue(card.deadline)}">
                <mat-icon
                    class="icon-size-4 text-current"
                    [svgIcon]="'heroicons_outline:clock'"></mat-icon>
                <div class="ml-1">
                    {{card.deadline | date: 'longDate'}}
                </div>
            </div>
            
        </ng-container>
        
        <ng-container>
            <div class="checkListTable mr-4 mb-2"
            [ngClass]="{
                'checkListTablegrey': card.checkListInfo.completed !== card.checkListInfo.total || card.checkListInfo.total === 0,
                'checkListTablegreen': card.checkListInfo.completed === card.checkListInfo.total && card.checkListInfo.total !== 0}">
                <mat-icon svgIcon="heroicons_outline:clipboard-check"></mat-icon>
                {{card.checkListInfo.completed}}/{{card.checkListInfo.total}}
            </div>
        </ng-container>
        
        
        
        <div class="subtasks_button">
            <div class="subtasks "  matBadgeColor="warn" [matBadge]="card.subtasks_count" matBadgeSize="small" matBadgePosition="before">
                <mat-icon  [matTooltip]="'Subtasks'" [matTooltipPosition]="'above'" svgIcon="mat_solid:playlist_add" ></mat-icon>
            </div>
        </div>
        
    </div>
    <!-- <ng-container *ngIf="expandedSubtasks === card.id">
        <div class="position-relative" *ngIf="(subtasksData$ | async).length" style="height: 16px;margin-top: -0.75rem;">
            <div class="subitem-kanban-card">
                <div class="subitem-kanban-card-arrow-wrapper" style="width: 16px;height:16px;"><div class="subitem-arrow-component" style="border-color: rgb(226, 68, 92);right: auto;left: 0;"><div class="subitem-arrow-component-top subitem-arrow-no-line" style="border-color: rgb(226, 68, 92);"></div><div class="subitem-arrow-component-bottom" style="border-color: rgb(226, 68, 92);"></div></div></div>
            </div>
        </div>
        
        <ng-container *ngFor="let subtaskTask of subtasksData$ | async; let firsttt = first; let lasttt = last; trackBy: trackByFn;">
            <div class="flex position-relative">
                <div class="subitem-kanban-card" *ngIf="firsttt && !lasttt">
                    <div class="subitem-kanban-card-arrow-wrapper"><div class="subitem-arrow-component" style="border-color: rgb(226, 68, 92);"><div class="subitem-arrow-component-top" style="border-color: rgb(226, 68, 92);"></div><div class="subitem-arrow-component-bottom" style="border-color: rgb(226, 68, 92);"></div></div></div>
                </div>
                <div class="subitem-kanban-card" *ngIf="!firsttt && !lasttt">
                    <div class="subitem-kanban-card-arrow-wrapper"><div class="subitem-arrow-component" style="border-color: rgb(226, 68, 92);"><div class="subitem-arrow-component-top" style="border-color: rgb(226, 68, 92);"></div><div class="subitem-arrow-component-bottom" style="border-color: rgb(226, 68, 92);"></div></div></div>
                </div> 
                <div class="subitem-kanban-card" *ngIf="lasttt">
                    <div class="subitem-kanban-card-arrow-wrapper"><div class="subitem-arrow-component" style="border-color: rgb(226, 68, 92);"><div class="subitem-arrow-component-top" style="border-color: rgb(226, 68, 92);"></div></div></div>
                </div>
                <a
                    class="flex flex-col items-start mb-3 p-5 space-y-1 shadow rounded-lg overflow-hidden bg-card"
                    [routerLink]="['subtask', subtaskTask.id]"
                    style="width: 100%;
                    margin-left: 25px;"
                    >
                    <div class="subtask_list not_collapsed" >
                        <div >
                            {{subtaskTask.title}}
                        </div>
                    </div>
                </a>
            </div>
        </ng-container>
        
    </ng-container> -->
</div>
</div>